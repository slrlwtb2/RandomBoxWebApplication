<!DOCTYPE html>
<html>
  <head>
    <title>Items</title>
    <link rel="stylesheet" href="Css/Item.css" />
    <link rel="stylesheet" href="Css/Header.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=VT323&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <my-header></my-header>
    <h1>Items</h1>

    <!-- Loading screen -->
    <div id="loadingScreen" style="display: none">
      <div id="loadingSpinner"></div>
    </div>

    <div id="item-container" class="item-container"></div>
    <script src="JS/header.js" type="module"></script>
    <script>
      // Show loading screen
      function showLoadingScreen() {
        document.getElementById("loadingScreen").style.display = "block";
      }

      // Hide loading screen
      function hideLoadingScreen() {
        document.getElementById("loadingScreen").style.display = "none";
      }

      document.addEventListener("DOMContentLoaded", function () {
        const token = localStorage.getItem("jwtToken");

        if (token) {
          const itemContainer = document.getElementById("item-container");

          showLoadingScreen(); // Show loading screen while fetching data

          fetch(
            "https://randomboxwebapplication.azurewebsites.net/api/Item/GetItems",
            {
              method: "GET",
              headers: {
                Authorization: "Bearer " + token,
                "Content-Type": "application/json",
              },
            }
          )
            .then((response) => {
              hideLoadingScreen(); // Hide loading screen after the fetch
              if (response.ok) {
                return response.json();
              } else {
                throw new Error(
                  "Request failed with status " + response.status
                );
              }
            })
            .then((data) => {
              // Process the response data and display it on the page
              const itemList = data.map((item) => {
                return `
                    <div class="item">
                      <img src="https://randomboxwebapplication.azurewebsites.net/api/Item/GetImage/${item.id}" alt="${item.name}" />
                      <div>${item.name}</div>
                      <div>Rarity: ${item.rarity}</div>
                      <div>Price: ${item.price}</div>
                    </div>
                  `;
              });

              itemContainer.innerHTML = itemList.join("");
            })
            .catch((error) => {
              hideLoadingScreen(); // Hide loading screen on error too
              console.error("Error:", error);
            });
        }
      });
    </script>
  </body>
</html>
